<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Local AI Studio - 9 Premium Open Source Models</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* Premium Core Colors */
        --primary: #6366f1; /* Changed from #0066CC - Indigo */
        --cyan: #06b6d4; /* Changed from #00D9FF - Softer cyan */
        --purple: #a78bfa; /* Softer purple */
        --accent-gold: #fbbf24; /* NEW - Premium exclusive color */

        /* Keep existing */
        --green: #10b981;
        --bg: #0a0e27;
        --bg-secondary: #111c44;
        --text: #f5f7ff;
        --text-secondary: #a0aec0;
        --border: #2d3a6f;

        /* Glass Effects - Refined */
        --glass-bg: rgba(17, 28, 68, 0.5); /* More opaque for elegance */
        --glass-border: rgba(
          255,
          255,
          255,
          0.12
        ); /* Thicker for premium feel */
        --glass-hover: rgba(255, 255, 255, 0.08);

        /* Easing Functions */
        --ease-smooth: cubic-bezier(0.34, 1.56, 0.64, 1);
        --ease-standard: cubic-bezier(0.4, 0, 0.2, 1);
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(
          135deg,
          var(--bg) 0%,
          #0f1635 50%,
          #1a0f35 100%
        );
        background-attachment: fixed;
        color: var(--text);
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Glassmorphism utility */
      .glass {
        background: var(--glass-bg);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid var(--glass-border);
      }

      .glass:hover {
        background: var(--glass-hover);
        border-color: rgba(255, 255, 255, 0.15);
      }

      /* Header */
      .header {
        background: rgba(17, 28, 68, 0.6);
        backdrop-filter: blur(40px) saturate(180%);
        -webkit-backdrop-filter: blur(40px) saturate(180%);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .brand-logo-wrapper {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .brand-logo {
        width: 100%;
        height: 100%;
        filter: drop-shadow(0 0 12px rgba(99, 102, 241, 0.15));
        animation: logoGlow 3s ease-in-out infinite;
      }

      @keyframes logoGlow {
        0%,
        100% {
          filter: drop-shadow(0 0 12px rgba(99, 102, 241, 0.15));
        }
        50% {
          filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.25));
        }
      }

      .logo h1 {
        font-size: 1.5rem;
        font-weight: 600;
        letter-spacing: -0.02em;
        background: linear-gradient(
          135deg,
          #e0e7ff 0%,
          #ddd6fe 50%,
          #e9d5ff 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
        line-height: 1.2;
      }

      .header-controls {
        display: flex;
        align-items: center;
        gap: 1.5rem;
      }

      .model-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .model-selector label {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      /* Connection Status Indicator */
      .status-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--green);
        box-shadow: 0 0 12px var(--green);
        animation: pulse-dot 2s ease-in-out infinite;
      }

      .status-dot.disconnected {
        background: #ef4444;
        box-shadow: 0 0 12px #ef4444;
        animation: none;
      }

      .status-dot.connecting {
        background: #f59e0b;
        box-shadow: 0 0 12px #f59e0b;
        animation: pulse-dot 1s ease-in-out infinite;
      }

      @keyframes pulse-dot {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.8;
        }
      }

      /* Custom Dropdown Styles */
      .custom-select {
        position: relative;
        min-width: 250px;
        cursor: pointer;
        user-select: none;
      }

      .select-selected {
        background: rgba(30, 41, 59, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 217, 255, 0.3);
        border-radius: 12px;
        padding: 0.75rem 2.5rem 0.75rem 1rem;
        color: #ffffff;
        font-family: "Inter", sans-serif;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }

      .select-selected::after {
        content: "▼";
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #00d9ff;
        font-size: 0.7rem;
      }

      .custom-select.open .select-selected::after {
        transform: translateY(-50%) rotate(180deg);
      }

      .select-selected:hover {
        background: rgba(30, 41, 59, 1);
        border-color: rgba(0, 217, 255, 0.5);
        box-shadow: 0 4px 16px rgba(0, 217, 255, 0.2);
      }

      .select-items {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        z-index: 1000;
        background: rgba(15, 23, 42, 0.98);
        border: 1px solid rgba(0, 217, 255, 0.3);
        border-radius: 12px;
        margin-top: 0.5rem;
        max-height: 400px;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        display: none;
      }

      .custom-select.open .select-items {
        display: block;
      }

      .select-group-label {
        padding: 0.75rem 1rem;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #00d9ff;
        background: rgba(0, 217, 255, 0.05);
        border-bottom: 1px solid rgba(0, 217, 255, 0.1);
      }

      .select-option {
        padding: 0.75rem 1rem;
        color: #ffffff;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
      }

      .select-option:hover {
        background: linear-gradient(
          90deg,
          rgba(0, 217, 255, 0.2),
          rgba(16, 185, 129, 0.2)
        );
        padding-left: 1.25rem;
      }

      .select-option.selected {
        background: rgba(0, 217, 255, 0.15);
        border-left: 3px solid #00d9ff;
      }

      .select-option.installed::after {
        content: "✓";
        position: absolute;
        right: 1rem;
        color: var(--green);
        font-weight: 700;
      }

      .status-badge {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(16, 185, 129, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--green);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Main Layout with Sidebar */
      .main-layout {
        flex: 1;
        display: flex;
        overflow: hidden;
      }

      /* Chat Container */
      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: 1400px;
        width: 100%;
        margin: 0 auto;
        padding: 2rem;
        overflow: hidden;
      }

      /* Affiliate Sidebar */
      .affiliate-sidebar {
        width: 320px;
        background: rgba(17, 28, 68, 0.4);
        backdrop-filter: blur(40px) saturate(180%);
        -webkit-backdrop-filter: blur(40px) saturate(180%);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1.5rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        box-shadow: -8px 0 32px rgba(0, 0, 0, 0.15);
      }

      .affiliate-sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .affiliate-sidebar::-webkit-scrollbar-track {
        background: transparent;
      }

      .affiliate-sidebar::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 3px;
      }

      .affiliate-section {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1.25rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .affiliate-section:hover {
        background: rgba(255, 255, 255, 0.08);
        border-color: rgba(0, 217, 255, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0, 217, 255, 0.15);
      }

      .affiliate-section h3 {
        font-size: 0.875rem;
        color: var(--cyan);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .affiliate-disclaimer {
        font-size: 0.625rem;
        color: var(--text-secondary);
        margin-bottom: 0.75rem;
        font-style: italic;
      }

      .affiliate-links {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .affiliate-link {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        text-decoration: none;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }

      .affiliate-link:hover {
        background: rgba(0, 217, 255, 0.08);
        border-color: rgba(0, 217, 255, 0.4);
        transform: translateX(-3px);
        box-shadow: 0 4px 12px rgba(0, 217, 255, 0.15);
      }

      .affiliate-link-name {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text);
      }

      .affiliate-link-desc {
        font-size: 0.75rem;
        color: var(--text-secondary);
        line-height: 1.4;
      }

      .affiliate-link-badge {
        display: inline-block;
        padding: 0.125rem 0.5rem;
        background: rgba(16, 185, 129, 0.1);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 6px;
        font-size: 0.625rem;
        color: var(--green);
        font-weight: 600;
        text-transform: uppercase;
        margin-top: 0.25rem;
        width: fit-content;
        box-shadow: 0 1px 3px rgba(16, 185, 129, 0.1);
      }

      /* Messages */
      .messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .messages::-webkit-scrollbar {
        width: 8px;
      }

      .messages::-webkit-scrollbar-track {
        background: transparent;
      }

      .messages::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 4px;
      }

      .message {
        display: flex;
        gap: 1rem;
        animation: fadeIn 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        flex-direction: row-reverse;
      }

      .message-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        flex-shrink: 0;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .message.user .message-avatar {
        background: linear-gradient(135deg, var(--primary), var(--cyan));
      }

      .message.assistant .message-avatar {
        background: linear-gradient(135deg, var(--purple), #9333ea);
      }

      .message-content {
        flex: 1;
        max-width: 75%;
      }

      .message-bubble {
        background: rgba(17, 28, 68, 0.5);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 1.25rem 1.5rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      }

      .message.assistant .message-bubble {
        border-left: 3px solid var(--purple);
        background: linear-gradient(
          135deg,
          rgba(124, 58, 237, 0.1),
          rgba(17, 28, 68, 0.5)
        );
      }

      .message.user .message-bubble {
        background: linear-gradient(
          135deg,
          rgba(0, 102, 204, 0.15),
          rgba(0, 217, 255, 0.08)
        );
        border: 1px solid rgba(0, 217, 255, 0.25);
      }

      .message-text {
        color: var(--text);
        line-height: 1.7;
        font-size: 1rem;
      }

      .message-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
      }

      .message-time {
        font-size: 0.75rem;
        color: var(--text-secondary);
      }

      .message-model {
        font-size: 0.75rem;
        color: var(--cyan);
        font-weight: 600;
      }

      /* Input Area */
      .input-area {
        background: rgba(17, 28, 68, 0.6);
        backdrop-filter: blur(40px) saturate(180%);
        -webkit-backdrop-filter: blur(40px) saturate(180%);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1.5rem 2rem;
        box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.2);
      }

      .input-form {
        display: flex;
        gap: 1rem;
        max-width: 1400px;
        margin: 0 auto;
        align-items: flex-end;
      }

      .input-wrapper {
        flex: 1;
        position: relative;
      }

      #messageInput {
        width: 100%;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(15px) saturate(180%);
        -webkit-backdrop-filter: blur(15px) saturate(180%);
        border: 2px solid rgba(255, 255, 255, 0.12);
        border-radius: 18px;
        padding: 1.125rem 1.5rem;
        color: var(--text);
        font-family: "Inter", sans-serif;
        font-size: 1rem;
        resize: none;
        min-height: 60px;
        max-height: 200px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      }

      #messageInput:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(0, 217, 255, 0.3);
      }

      #messageInput:focus {
        outline: none;
        border-color: var(--cyan);
        background: rgba(0, 217, 255, 0.05);
        box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1),
          0 8px 24px rgba(0, 217, 255, 0.2);
      }

      #messageInput::placeholder {
        color: var(--text-secondary);
      }

      #sendButton {
        background: linear-gradient(135deg, var(--primary), var(--cyan));
        border: none;
        border-radius: 16px;
        padding: 1.25rem 3.5rem; /* Increased */
        color: white;
        font-weight: 800; /* Increased from 700 */
        font-size: 1.125rem; /* Increased from 1rem */
        cursor: pointer;
        transition: all 0.3s var(--ease-smooth);
        white-space: nowrap;
        box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4); /* Deeper shadow */
        position: relative;
        overflow: hidden;
      }

      #sendButton::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        transition: left 0.6s var(--ease-smooth);
      }

      #sendButton:hover::before {
        left: 100%;
      }

      #sendButton:hover {
        transform: translateY(-4px) scale(1.05); /* More dramatic */
        box-shadow: 0 20px 60px rgba(6, 182, 212, 0.5),
          0 0 30px rgba(6, 182, 212, 0.3);
      }

      #sendButton:active {
        transform: translateY(-2px) scale(1.02);
      }

      #sendButton:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        filter: grayscale(1);
      }

      #sendButton:disabled:hover {
        transform: none;
        box-shadow: 0 4px 20px rgba(0, 102, 204, 0.4);
      }

      /* Loading Animation */
      .loading {
        display: inline-flex;
        gap: 6px;
      }

      .loading span {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--cyan);
        animation: bounce 1.4s infinite ease-in-out both;
      }

      .loading span:nth-child(1) {
        animation-delay: -0.32s;
      }
      .loading span:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      /* Welcome Screen */
      .welcome {
        text-align: center;
        padding: 4rem 2rem;
        animation: fadeIn 0.5s ease-out;
      }

      .welcome h2 {
        font-size: 3.5rem; /* Increased from 2.5rem */
        font-weight: 900; /* Increased from 800 */
        background: linear-gradient(
          135deg,
          #f5f7ff 0%,
          var(--cyan) 50%,
          var(--purple) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1.5rem;
        letter-spacing: -0.03em; /* NEW */
        text-shadow: 0 2px 40px rgba(6, 182, 212, 0.2); /* NEW */
      }

      .welcome p {
        font-size: 1.25rem; /* Increased from 1.125rem */
        color: var(--text-secondary);
        margin-bottom: 2rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        font-weight: 500; /* NEW */
        letter-spacing: -0.01em; /* NEW */
        line-height: 1.7; /* NEW */
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        max-width: 900px;
        margin: 0 auto;
      }

      .feature-card {
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.5) 0%,
          rgba(6, 182, 212, 0.05) 100%
        );
        backdrop-filter: blur(20px) saturate(200%);
        -webkit-backdrop-filter: blur(20px) saturate(200%);
        border: 1px solid rgba(6, 182, 212, 0.2);
        border-radius: 20px;
        padding: 2rem;
        transition: all 0.4s var(--ease-smooth);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
      }

      .feature-card::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 20px;
        padding: 1px;
        background: linear-gradient(
          135deg,
          rgba(6, 182, 212, 0.3),
          rgba(167, 139, 250, 0.2)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0;
        transition: opacity 0.3s var(--ease-standard);
        pointer-events: none;
      }

      .feature-card:hover {
        transform: translateY(-8px) scale(1.03);
        border-color: rgba(6, 182, 212, 0.4);
        box-shadow: 0 20px 60px rgba(6, 182, 212, 0.25),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.6) 0%,
          rgba(6, 182, 212, 0.1) 100%
        );
      }

      .feature-card:hover::before {
        opacity: 1;
      }

      .feature-card h3 {
        font-size: 1.375rem;
        font-weight: 700;
        color: var(--cyan);
        margin-bottom: 0.75rem;
      }

      .feature-card p {
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.7;
      }

      /* Models Section */
      .models-section {
        padding: 2rem;
        animation: fadeIn 0.5s ease-out;
        background: transparent;
      }

      .models-header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .models-header h2 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--cyan), var(--purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.75rem;
      }

      .models-header p {
        font-size: 1.125rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto;
      }

      .models-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: 1.75rem;
        max-width: 1400px;
        margin: 0 auto;
      }

      .model-card {
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.5) 0%,
          rgba(99, 102, 241, 0.08) 50%,
          rgba(6, 182, 212, 0.05) 100%
        );
        backdrop-filter: blur(40px) saturate(200%);
        -webkit-backdrop-filter: blur(40px) saturate(200%);
        border: 1.5px solid rgba(6, 182, 212, 0.25);
        border-radius: 28px;
        padding: 2.5rem;
        transition: all 0.4s var(--ease-smooth);
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      .model-card::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 28px;
        padding: 1.5px;
        background: linear-gradient(
          135deg,
          rgba(6, 182, 212, 0.5),
          rgba(167, 139, 250, 0.3),
          rgba(251, 191, 36, 0.2)
        );
        -webkit-mask: linear-gradient(#fff 0 0) content-box,
          linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0;
        transition: opacity 0.4s var(--ease-smooth);
        pointer-events: none;
      }

      .model-card:hover {
        transform: translateY(-12px) scale(1.03);
        border-color: rgba(6, 182, 212, 0.6);
        box-shadow: 0 0 60px rgba(6, 182, 212, 0.4),
          0 30px 80px rgba(99, 102, 241, 0.25),
          inset 0 1px 0 rgba(255, 255, 255, 0.15);
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.6) 0%,
          rgba(99, 102, 241, 0.12) 50%,
          rgba(6, 182, 212, 0.1) 100%
        );
      }

      .model-card:hover::before {
        opacity: 1;
      }

      .model-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 1rem;
      }

      .model-info {
        flex: 1;
      }

      .model-name {
        font-size: 1.625rem;
        font-weight: 900;
        color: var(--text);
        margin-bottom: 0.375rem;
        letter-spacing: -0.02em;
      }

      .model-size {
        font-size: 0.875rem;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .model-badge {
        padding: 0.75rem 1.5rem;
        border-radius: 14px;
        font-size: 0.8125rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        white-space: nowrap;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: all 0.3s var(--ease-smooth);
        width: fit-content;
      }

      .model-badge.installed {
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.25),
          rgba(16, 185, 129, 0.12)
        );
        border: 1.5px solid rgba(16, 185, 129, 0.6);
        color: #6ee7b7;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
      }

      .model-badge.not-installed {
        background: linear-gradient(
          135deg,
          rgba(160, 174, 192, 0.15),
          rgba(160, 174, 192, 0.08)
        );
        border: 1.5px solid rgba(160, 174, 192, 0.4);
        color: var(--text-secondary);
      }

      .model-badge.installing {
        background: linear-gradient(
          135deg,
          rgba(0, 217, 255, 0.2),
          rgba(0, 217, 255, 0.1)
        );
        border: 1px solid rgba(0, 217, 255, 0.5);
        color: var(--cyan);
        animation: pulse-glow 1.5s ease-in-out infinite;
      }

      .model-description {
        font-size: 0.9375rem;
        color: var(--text-secondary);
        line-height: 1.6;
      }

      .model-use-cases {
        display: flex;
        flex-wrap: wrap;
        gap: 0.625rem;
      }

      .model-use-case {
        padding: 0.5rem 1.125rem;
        background: linear-gradient(
          135deg,
          rgba(6, 182, 212, 0.15),
          rgba(6, 182, 212, 0.08)
        );
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(6, 182, 212, 0.4);
        border-radius: 20px;
        font-size: 0.8125rem;
        font-weight: 700;
        color: var(--cyan);
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.1);
        transition: all 0.2s var(--ease-standard);
      }

      .model-use-case:hover {
        background: linear-gradient(
          135deg,
          rgba(6, 182, 212, 0.25),
          rgba(6, 182, 212, 0.15)
        );
        box-shadow: 0 4px 16px rgba(6, 182, 212, 0.2);
      }

      .model-actions {
        display: flex;
        gap: 0.875rem;
        margin-top: 0.75rem;
      }

      .model-button {
        flex: 1;
        padding: 1rem 1.5rem;
        border: none;
        border-radius: 14px;
        font-family: "Inter", sans-serif;
        font-size: 0.9375rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .model-button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .model-button:hover::before {
        width: 300px;
        height: 300px;
      }

      .model-button.primary {
        background: linear-gradient(135deg, var(--primary), var(--cyan));
        color: white;
        box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
      }

      .model-button.primary:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 12px 40px rgba(0, 217, 255, 0.5);
      }

      .model-button.install {
        background: linear-gradient(135deg, var(--cyan), var(--green));
        color: white;
        box-shadow: 0 6px 20px rgba(0, 217, 255, 0.4);
      }

      .model-button.install:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 12px 40px rgba(16, 185, 129, 0.5);
      }

      .model-button.secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: var(--text);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .model-button.secondary:hover {
        background: rgba(0, 217, 255, 0.2);
        border-color: var(--cyan);
        box-shadow: 0 8px 24px rgba(0, 217, 255, 0.3);
        transform: translateY(-3px);
      }

      .model-button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
        filter: grayscale(1);
      }

      .model-button:disabled:hover {
        transform: none;
        box-shadow: none;
      }

      .model-button:disabled::before {
        display: none;
      }

      /* Purchase Button */
      .purchase-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        animation: pulse-glow 2s ease-in-out infinite;
      }

      .purchase-btn:hover {
        background: linear-gradient(135deg, #059669, #047857);
        box-shadow: 0 8px 32px rgba(16, 185, 129, 0.6);
      }

      @keyframes pulse-glow {
        0%,
        100% {
          box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }
        50% {
          box-shadow: 0 8px 32px rgba(16, 185, 129, 0.6);
        }
      }

      /* Purchased Badge */
      .model-badge.purchased {
        background: rgba(16, 185, 129, 0.15);
        border: 1px solid rgba(16, 185, 129, 0.4);
        color: var(--green);
      }

      /* Progress Modal */
      .progress-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .progress-modal.active {
        opacity: 1;
        visibility: visible;
      }

      .progress-content {
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.9),
          rgba(124, 58, 237, 0.2)
        );
        backdrop-filter: blur(40px);
        -webkit-backdrop-filter: blur(40px);
        border: 2px solid rgba(0, 217, 255, 0.3);
        border-radius: 24px;
        padding: 3rem;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .progress-modal.active .progress-content {
        transform: scale(1);
      }

      .progress-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .progress-header h3 {
        font-size: 1.75rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--cyan), var(--purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
      }

      .progress-header p {
        color: var(--text-secondary);
        font-size: 1rem;
      }

      .progress-bar-container {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        overflow: hidden;
        height: 24px;
        margin-bottom: 1.5rem;
        position: relative;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--cyan), var(--green));
        border-radius: 12px;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        position: relative;
        overflow: hidden;
      }

      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .progress-percentage {
        text-align: center;
        font-size: 2rem;
        font-weight: 800;
        color: var(--cyan);
        margin-bottom: 0.5rem;
      }

      .progress-status {
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .progress-close {
        display: none;
        margin: 2rem auto 0;
        padding: 0.875rem 2rem;
        background: linear-gradient(135deg, var(--primary), var(--cyan));
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
      }

      .upgrade-btn {
        background: linear-gradient(135deg, #ec4899, #8b5cf6);
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 700;
        color: white;
        cursor: pointer;
        transition: all 0.3s var(--ease-smooth);
        box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
        position: relative;
        z-index: 50;
      }

      .progress-close.visible {
        display: block;
      }

      .progress-close:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(0, 217, 255, 0.5);
      }

      /* PRO Overlay & Badge */
      .pro-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 14, 39, 0.92);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 1.5rem;
        z-index: 10;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .model-card.pro-locked {
        position: relative;
      }

      .model-card.pro-locked .pro-overlay {
        opacity: 1;
        visibility: visible;
      }

      .model-card.pro-locked:hover .pro-overlay {
        background: rgba(10, 14, 39, 0.95);
      }

      .pro-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, #f59e0b, #d97706);
        border: 2px solid #fbbf24;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 800;
        color: #fef3c7;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4);
        animation: pulse-gold 2s ease-in-out infinite;
      }

      @keyframes pulse-gold {
        0%,
        100% {
          box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4);
        }
        50% {
          box-shadow: 0 12px 36px rgba(251, 191, 36, 0.6);
        }
      }

      .pro-unlock-text {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text);
        text-align: center;
        max-width: 300px;
      }

      .pro-unlock-btn {
        padding: 1rem 2rem;
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
        border-radius: 14px;
        font-family: "Inter", sans-serif;
        font-size: 1rem;
        font-weight: 700;
        color: white;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .pro-unlock-btn:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 12px 40px rgba(16, 185, 129, 0.6);
      }

      /* License Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(10, 14, 39, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .modal.active {
        opacity: 1;
        visibility: visible;
      }

      .modal-content {
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.95),
          rgba(124, 58, 237, 0.2)
        );
        backdrop-filter: blur(40px);
        -webkit-backdrop-filter: blur(40px);
        border: 2px solid rgba(0, 217, 255, 0.3);
        border-radius: 24px;
        padding: 3rem;
        max-width: 600px;
        width: 90%;
        box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        transform: scale(0.9);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal.active .modal-content {
        transform: scale(1);
      }

      .modal-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .modal-header h2 {
        font-size: 2rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--cyan), var(--purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.75rem;
      }

      .modal-header p {
        color: var(--text-secondary);
        font-size: 1rem;
        line-height: 1.6;
      }

      /* Partners Section (Renamed from Affiliates to avoid ad-blockers) */
      .partners-section {
        padding: 6rem 2rem;
        background: linear-gradient(
          180deg,
          rgba(17, 28, 68, 0) 0%,
          rgba(6, 182, 212, 0.05) 50%,
          rgba(17, 28, 68, 0) 100%
        );
        position: relative;
        overflow: hidden;
      }

      .partners-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .partners-header {
        text-align: center;
        margin-bottom: 4rem;
      }

      .partners-header h2 {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--cyan), var(--purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 1rem;
      }

      .partners-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
      }

      .partner-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 2rem;
        transition: all 0.3s var(--ease-smooth);
        text-decoration: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .partner-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--cyan);
        box-shadow: 0 10px 30px rgba(6, 182, 212, 0.15);
      }

      .partner-icon {
        font-size: 3rem;
        margin-bottom: 1.5rem;
      }

      .partner-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 0.5rem;
      }

      .partner-desc {
        font-size: 0.875rem;
        color: var(--text-secondary);
        line-height: 1.6;
      }


      .pricing-card {
        background: rgba(16, 185, 129, 0.1);
        border: 2px solid rgba(16, 185, 129, 0.4);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        text-align: center;
      }

      .pricing-price {
        font-size: 3rem;
        font-weight: 800;
        color: var(--green);
        margin-bottom: 0.5rem;
      }

      .pricing-features {
        list-style: none;
        padding: 0;
        margin: 1.5rem 0;
        text-align: left;
      }

      .pricing-features li {
        padding: 0.5rem 0;
        color: var(--text);
        font-size: 0.9375rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .pricing-features li::before {
        content: "✓";
        color: var(--green);
        font-weight: 700;
        font-size: 1.25rem;
      }

      .modal-actions {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 2rem;
      }

      .modal-btn {
        padding: 1.125rem 2rem;
        border: none;
        border-radius: 14px;
        font-family: "Inter", sans-serif;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-transform: uppercase;
        letter-spacing: 0.03em;
      }

      .modal-btn.primary {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
      }

      .modal-btn.primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 36px rgba(16, 185, 129, 0.6);
      }

      .modal-btn.secondary {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        color: var(--text);
      }

      .modal-btn.secondary:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      /* Modal Pricing Content */
      .pricing-header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .price-large {
        font-size: 3rem;
        font-weight: 800;
        color: #10b981;
        margin-bottom: 0.5rem;
      }

      .period {
        font-size: 1.25rem;
        color: var(--text-secondary);
        font-weight: 400;
      }

      .price-subtitle {
        color: var(--text-secondary);
        font-size: 1rem;
      }

      .features-list {
        margin: 2rem 0;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .feature-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 8px;
        transition: all 0.3s;
      }

      .feature-item:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateX(5px);
      }

      .feature-icon {
        font-size: 1.5rem;
      }

      .feature-text {
        color: var(--text);
        font-size: 0.95rem;
      }

      .license-form {
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .license-form h3 {
        font-size: 1.25rem;
        color: var(--cyan);
        margin-bottom: 1rem;
        text-align: center;
      }

      .license-form input {
        width: 100%;
        background: rgba(255, 255, 255, 0.08);
        border: 2px solid rgba(255, 255, 255, 0.12);
        border-radius: 12px;
        padding: 1rem 1.5rem;
        color: var(--text);
        font-family: "Inter", sans-serif;
        font-size: 1rem;
        margin-bottom: 1rem;
        transition: all 0.3s;
      }

      .license-form input:focus {
        outline: none;
        border-color: var(--cyan);
        background: rgba(0, 217, 255, 0.05);
        box-shadow: 0 0 0 4px rgba(0, 217, 255, 0.1);
      }

      .license-form input::placeholder {
        color: var(--text-secondary);
      }

      .license-error {
        background: rgba(239, 68, 68, 0.1);
        border: 1px solid rgba(239, 68, 68, 0.4);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        color: #fca5a5;
        font-size: 0.875rem;
        margin-top: 1rem;
        display: none;
      }

      .license-error.visible {
        display: block;
      }

      .license-success {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.4);
        border-radius: 8px;
        padding: 0.75rem 1rem;
        color: var(--green);
        font-size: 0.875rem;
        margin-top: 1rem;
        display: none;
      }

      .license-success.visible {
        display: block;
      }

      /* Upgrade Bar */
      #upgradeBar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(
          135deg,
          rgba(17, 28, 68, 0.98),
          rgba(124, 58, 237, 0.3)
        );
        backdrop-filter: blur(40px);
        -webkit-backdrop-filter: blur(40px);
        border-top: 2px solid rgba(251, 191, 36, 0.4);
        padding: 1.25rem 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 2rem;
        z-index: 9999;
        box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.3);
        opacity: 0;
        visibility: hidden;
        transform: translateY(100%);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      #upgradeBar.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }

      .upgrade-bar-content {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex: 1;
      }

      .upgrade-bar-icon {
        font-size: 2rem;
        animation: pulse-gold 2s ease-in-out infinite;
      }

      .upgrade-bar-text h4 {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 0.25rem;
      }

      .upgrade-bar-text p {
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .upgrade-bar-btn {
        padding: 1rem 2.5rem;
        background: linear-gradient(135deg, #10b981, #059669);
        border: none;
        border-radius: 14px;
        font-family: "Inter", sans-serif;
        font-size: 1rem;
        font-weight: 700;
        color: white;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        text-transform: uppercase;
        letter-spacing: 0.03em;
        white-space: nowrap;
      }

      .upgrade-bar-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 12px 36px rgba(16, 185, 129, 0.6);
      }

      .upgrade-bar-close {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 8px;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-secondary);
        font-size: 1.25rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .upgrade-bar-close:hover {
        background: rgba(255, 255, 255, 0.15);
        color: var(--text);
      }

      /* Responsive */
      @media (max-width: 1024px) {
        .affiliate-sidebar {
          display: none;
        }

        #upgradeBar {
          flex-direction: column;
          gap: 1rem;
          padding: 1rem;
        }

        .upgrade-bar-content {
          flex-direction: column;
          text-align: center;
        }
      }

      @media (max-width: 768px) {
        .models-grid {
          grid-template-columns: 1fr;
        }

        .progress-content {
          padding: 2rem;
        }

        .modal-content {
          padding: 2rem;
        }
      }

      /* Premium Design - Mobile Responsiveness */
      @media (max-width: 768px) {
        .welcome h2 {
          font-size: 2rem;
          margin-bottom: 1rem;
        }

        .welcome p {
          font-size: 1rem;
          margin-bottom: 1.5rem;
        }

        #sendButton {
          padding: 1rem 2rem;
          font-size: 1rem;
        }

        .model-card {
          padding: 1.5rem;
          border-radius: 24px;
          gap: 1.25rem;
        }

        .model-name {
          font-size: 1.25rem;
        }

        .feature-card {
          padding: 1.5rem;
          border-radius: 18px;
        }

        .feature-card h3 {
          font-size: 1.125rem;
          margin-bottom: 0.5rem;
        }

        .models-header h2 {
          font-size: 2rem;
        }
      }

      @media (max-width: 480px) {
        .welcome h2 {
          font-size: 1.75rem;
          margin-bottom: 0.75rem;
        }

        .welcome p {
          font-size: 0.9375rem;
          line-height: 1.6;
        }

        #sendButton {
          padding: 0.875rem 1.5rem;
          font-size: 0.9375rem;
        }

        .model-card {
          padding: 1.25rem;
          border-radius: 20px;
          gap: 1rem;
        }

        .model-name {
          font-size: 1.125rem;
        }

        .model-badge {
          padding: 0.5rem 1rem;
          font-size: 0.75rem;
        }

        .feature-card {
          padding: 1.25rem;
          border-radius: 16px;
        }

        .feature-card h3 {
          font-size: 1rem;
        }

        .models-header h2 {
          font-size: 1.5rem;
        }

        .models-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">
        <div class="brand-logo-wrapper">
          <svg
            class="brand-logo"
            viewBox="0 0 64 64"
            xmlns="http://www.w3.org/2000/svg"
          >
            <defs>
              <linearGradient
                id="nodeGradient"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="100%"
              >
                <stop
                  offset="0%"
                  style="stop-color: #6366f1; stop-opacity: 1"
                />
                <stop
                  offset="100%"
                  style="stop-color: #8b5cf6; stop-opacity: 1"
                />
              </linearGradient>
              <filter id="glow">
                <feGaussianBlur stdDeviation="2" result="coloredBlur" />
                <feMerge>
                  <feMergeNode in="coloredBlur" />
                  <feMergeNode in="SourceGraphic" />
                </feMerge>
              </filter>
              <radialGradient id="centerGlow" cx="50%" cy="50%" r="50%">
                <stop
                  offset="0%"
                  style="stop-color: #a78bfa; stop-opacity: 0.4"
                />
                <stop
                  offset="100%"
                  style="stop-color: #8b5cf6; stop-opacity: 0"
                />
              </radialGradient>
            </defs>
            <circle
              cx="32"
              cy="32"
              r="32"
              fill="url(#centerGlow)"
              opacity="0.6"
            />
            <circle
              cx="32"
              cy="32"
              r="28"
              fill="none"
              stroke="#6366F1"
              stroke-width="0.5"
              opacity="0.2"
            />
            <line
              x1="32"
              y1="32"
              x2="32"
              y2="8"
              stroke="#6366F1"
              stroke-width="1.5"
              opacity="0.6"
            />
            <line
              x1="32"
              y1="32"
              x2="48"
              y2="16"
              stroke="#6366F1"
              stroke-width="1.5"
              opacity="0.6"
            />
            <line
              x1="32"
              y1="32"
              x2="48"
              y2="48"
              stroke="#6366F1"
              stroke-width="1.5"
              opacity="0.6"
            />
            <line
              x1="32"
              y1="32"
              x2="32"
              y2="56"
              stroke="#8B5CF6"
              stroke-width="1.5"
              opacity="0.6"
            />
            <line
              x1="32"
              y1="32"
              x2="16"
              y2="48"
              stroke="#8B5CF6"
              stroke-width="1.5"
              opacity="0.6"
            />
            <line
              x1="32"
              y1="32"
              x2="16"
              y2="16"
              stroke="#8B5CF6"
              stroke-width="1.5"
              opacity="0.6"
            />
            <circle cx="32" cy="8" r="3" fill="#6366F1" filter="url(#glow)" />
            <circle cx="48" cy="16" r="3" fill="#6366F1" filter="url(#glow)" />
            <circle cx="48" cy="48" r="3" fill="#8B5CF6" filter="url(#glow)" />
            <circle cx="32" cy="56" r="3" fill="#8B5CF6" filter="url(#glow)" />
            <circle cx="16" cy="48" r="3" fill="#8B5CF6" filter="url(#glow)" />
            <circle cx="16" cy="16" r="3" fill="#6366F1" filter="url(#glow)" />
            <polygon
              points="32,22 38,25 38,31 32,34 26,31 26,25"
              fill="url(#nodeGradient)"
              filter="url(#glow)"
              opacity="0.9"
            />
            <circle cx="32" cy="28" r="2.5" fill="#E0E7FF" opacity="0.6" />
            <circle
              cx="32"
              cy="32"
              r="30"
              fill="none"
              stroke="url(#nodeGradient)"
              stroke-width="0.75"
              opacity="0.3"
            />
          </svg>
        </div>
        <h1>Local AI Studio</h1>
      </div>
      <div class="header-controls">
        <div class="model-selector">
          <label for="modelSelect">Model:</label>
          <div class="custom-select" id="customSelect">
            <div class="select-selected">TinyLlama 1.1B - FREE</div>
            <div class="select-items" id="selectItems">
              <!-- Will be populated dynamically -->
            </div>
          </div>
          <input type="hidden" id="modelSelect" value="tinyllama:latest" />
        </div>
        <div class="status-badge">
          <span class="status-dot"></span>
          <span id="statusText">100% Local</span>
        </div>
        <button
          onclick="scrollToMarketplace()"
          style="
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.3s;
            margin-left: 1rem;
          "
        >
          💎 Model Marketplace
        </button>
        <button class="upgrade-btn" onclick="showUpgradeModal()">
          Get Pro Access
        </button>
      </div>
    </div>

    <div class="main-layout">
      <div class="chat-container">
        <div class="messages" id="messages">
          <div class="models-section">
            <div class="models-header">
              <h2>9 Premium Open Source Models</h2>
              <p>3 free models to start with, plus 6 pro models with license</p>
            </div>

            <div class="models-grid">
              <!-- TinyLlama 1.1B - PRE-INSTALLED -->
              <div class="model-card" data-model-id="tinyllama:latest">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">TinyLlama 1.1B ⚡</div>
                    <div class="model-size">637 MB • Pre-installed</div>
                  </div>
                  <div class="model-badge installed">✓ INSTALLED</div>
                </div>
                <div class="model-description">
                  Your instant-start AI companion. Lightweight and fast, perfect
                  for quick conversations and getting started immediately.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(16, 185, 129, 0.1);
                      border-left: 3px solid #10b981;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~2GB RAM</strong> • Runs on any modern
                    computer
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Instant Start</span>
                  <span class="model-use-case">Quick Q&A</span>
                  <span class="model-use-case">Fast Responses</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button primary chat-btn"
                    data-model="tinyllama:latest"
                    style="width: 100%"
                  >
                    Start Chat Now
                  </button>
                </div>
              </div>

              <!-- Llama 3.2 3B -->
              <div class="model-card" data-model-id="llama3.2:3b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Llama 3.2 3B</div>
                    <div class="model-size">2.0 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Meta's latest model with excellent balance of speed and
                  intelligence. Great for everyday conversations and creative
                  tasks.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(251, 191, 36, 0.1);
                      border-left: 3px solid #f59e0b;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~4-6GB RAM</strong> • Best with 8GB+
                    system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Conversations</span>
                  <span class="model-use-case">Writing</span>
                  <span class="model-use-case">Analysis</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="llama3.2:3b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="llama3.2:3b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Llama 3.1 8B -->
              <div class="model-card" data-model-id="llama3.1:8b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Llama 3.1 8B</div>
                    <div class="model-size">4.7 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Powerful and versatile model with excellent reasoning
                  capabilities. Perfect balance between performance and resource
                  usage.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(239, 68, 68, 0.1);
                      border-left: 3px solid #ef4444;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~8-10GB RAM</strong> • Recommended:
                    16GB system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Complex Tasks</span>
                  <span class="model-use-case">Reasoning</span>
                  <span class="model-use-case">Analysis</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="llama3.1:8b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="llama3.1:8b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- CodeLlama 7B -->
              <div class="model-card" data-model-id="codellama:7b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">CodeLlama 7B</div>
                    <div class="model-size">3.8 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Specialized for code generation, debugging, and explanations.
                  Supports all major programming languages with expert-level
                  knowledge.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(239, 68, 68, 0.1);
                      border-left: 3px solid #ef4444;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~8GB RAM</strong> • Best with 12GB+
                    system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Code Generation</span>
                  <span class="model-use-case">Debugging</span>
                  <span class="model-use-case">Refactoring</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="codellama:7b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="codellama:7b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Mistral 7B Instruct -->
              <div class="model-card" data-model-id="mistral:7b-instruct">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Mistral 7B Instruct</div>
                    <div class="model-size">4.1 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Excellent at following complex instructions and creative
                  writing. Known for its nuanced understanding and expressive
                  outputs.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(239, 68, 68, 0.1);
                      border-left: 3px solid #ef4444;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~8GB RAM</strong> • Best with 12GB+
                    system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Creative Writing</span>
                  <span class="model-use-case">Instructions</span>
                  <span class="model-use-case">Storytelling</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="mistral:7b-instruct"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="mistral:7b-instruct"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Phi-3 Medium -->
              <div class="model-card" data-model-id="phi3:medium">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Phi-3 Medium</div>
                    <div class="model-size">7.9 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Microsoft's larger Phi model with enhanced capabilities.
                  Exceptional performance on reasoning and mathematical tasks.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(239, 68, 68, 0.1);
                      border-left: 3px solid #ef4444;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~10-12GB RAM</strong> • Recommended:
                    16GB system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Mathematics</span>
                  <span class="model-use-case">Logic</span>
                  <span class="model-use-case">Science</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="phi3:medium"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="phi3:medium"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Gemma 2 2B -->
              <div class="model-card" data-model-id="gemma2:2b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Gemma 2 2B</div>
                    <div class="model-size">1.6 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Google's ultra-efficient model. Lightning-fast responses
                  without sacrificing quality. Perfect for real-time
                  applications.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(16, 185, 129, 0.1);
                      border-left: 3px solid #10b981;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~3-4GB RAM</strong> • Works great on
                    8GB systems
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Speed</span>
                  <span class="model-use-case">Quick Tasks</span>
                  <span class="model-use-case">Low Latency</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="gemma2:2b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="gemma2:2b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Gemma 2 9B -->
              <div class="model-card" data-model-id="gemma2:9b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Gemma 2 9B</div>
                    <div class="model-size">5.5 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Google's larger Gemma variant with superior performance.
                  Excellent for complex reasoning and multi-step problem
                  solving.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(239, 68, 68, 0.1);
                      border-left: 3px solid #ef4444;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~9-11GB RAM</strong> • Recommended:
                    16GB system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Advanced Tasks</span>
                  <span class="model-use-case">Research</span>
                  <span class="model-use-case">Problem Solving</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="gemma2:9b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="gemma2:9b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Phi-3.5 Mini -->
              <div class="model-card" data-model-id="phi3.5:mini">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Phi-3.5 Mini</div>
                    <div class="model-size">2.2 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Microsoft's long-context specialist with 128K token window.
                  Analyze entire books or extensive codebases in one go.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(251, 191, 36, 0.1);
                      border-left: 3px solid #f59e0b;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~4-6GB RAM</strong> • Best with 8GB+
                    system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Long Documents</span>
                  <span class="model-use-case">Book Analysis</span>
                  <span class="model-use-case">128K Context</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="phi3.5:mini"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="phi3.5:mini"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Qwen 2.5 7B -->
              <div class="model-card" data-model-id="qwen2.5:7b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Qwen 2.5 7B</div>
                    <div class="model-size">4.7 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Alibaba's coding powerhouse. Exceptional at programming tasks,
                  technical documentation, and system design.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(239, 68, 68, 0.1);
                      border-left: 3px solid #ef4444;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~8GB RAM</strong> • Best with 12GB+
                    system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Coding</span>
                  <span class="model-use-case">Architecture</span>
                  <span class="model-use-case">Technical Docs</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="qwen2.5:7b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="qwen2.5:7b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>

              <!-- Deepseek Coder 6.7B -->
              <div class="model-card" data-model-id="deepseek-coder:6.7b">
                <div class="model-header">
                  <div class="model-info">
                    <div class="model-name">Deepseek Coder 6.7B</div>
                    <div class="model-size">3.8 GB</div>
                  </div>
                  <div class="model-badge not-installed">Not Installed</div>
                </div>
                <div class="model-description">
                  Specialized coding model trained on 2 trillion tokens of code.
                  Exceptional at code completion and generation.
                  <div
                    style="
                      margin-top: 0.5rem;
                      padding: 0.5rem;
                      background: rgba(251, 191, 36, 0.1);
                      border-left: 3px solid #f59e0b;
                      border-radius: 4px;
                      font-size: 0.75rem;
                    "
                  >
                    <strong>💻 Requires: ~6-8GB RAM</strong> • Best with 12GB+
                    system RAM
                  </div>
                </div>
                <div class="model-use-cases">
                  <span class="model-use-case">Autocomplete</span>
                  <span class="model-use-case">Code Review</span>
                  <span class="model-use-case">Unit Tests</span>
                </div>
                <div class="model-actions">
                  <button
                    class="model-button install install-btn"
                    data-model="deepseek-coder:6.7b"
                  >
                    Install Now
                  </button>
                  <button
                    class="model-button primary chat-btn"
                    data-model="deepseek-coder:6.7b"
                    disabled
                  >
                    Start Chat
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="input-area">
          <form class="input-form" id="chatForm">
            <div class="input-wrapper">
              <textarea
                id="messageInput"
                placeholder="Ask anything... (Shift+Enter for new line)"
                rows="1"
              ></textarea>
            </div>
            <button type="submit" id="sendButton">Send</button>
          </form>
        </div>
      </div>

      <!-- Affiliate Sidebar -->
      <div class="affiliate-sidebar">
        <div class="affiliate-section">
          <h3>🚀 Need More Power?</h3>
          <p class="affiliate-disclaimer">
            Affiliate links - we earn a commission at no extra cost to you
          </p>
          <div class="affiliate-links" id="hostingLinks">
            <a
              href="https://www.hostinger.com/cart?product=vps%3Avps_kvm_2&period=12&referral_type=cart_link&REFERRALCODE=MY3WMELDMJJA&referral_id=0199b1ef-5964-73cf-be72-428a967f8968"
              target="_blank"
              class="affiliate-link"
            >
              <span class="affiliate-link-name">Hostinger VPS KVM2</span>
              <span class="affiliate-link-desc"
                >4 vCPU, 8GB RAM - Perfect for larger models</span
              >
              <span class="affiliate-link-badge">Recommended</span>
            </a>
            <a
              href="https://www.hostinger.com/cart?product=vps%3Avps_kvm_4&period=12&referral_type=cart_link&REFERRALCODE=MY3WMELDMJJA&referral_id=0199b1f0-bba3-713b-b351-a0eaa85b1aed"
              target="_blank"
              class="affiliate-link"
            >
              <span class="affiliate-link-name">Hostinger VPS KVM4</span>
              <span class="affiliate-link-desc"
                >8 vCPU, 16GB RAM - Production ready</span
              >
            </a>
          </div>
        </div>

        <div class="affiliate-section">
          <h3>☁️ Cloud GPU Inference</h3>
          <p class="affiliate-disclaimer">
            Deploy massive models with cloud GPUs
          </p>
          <div class="affiliate-links">
            <a
              href="https://app.hyperbolic.ai/invite/llUtil8hH"
              target="_blank"
              class="affiliate-link"
            >
              <span class="affiliate-link-name">Hyperbolic</span>
              <span class="affiliate-link-desc"
                >Open-source cloud GPU for AI inference</span
              >
              <span class="affiliate-link-badge">Free Tier</span>
            </a>
            <a
              href="https://cloud.cerebras.ai?referral_code=n24vxp64"
              target="_blank"
              class="affiliate-link"
            >
              <span class="affiliate-link-name">Cerebras</span>
              <span class="affiliate-link-desc"
                >Ultra-fast AI on specialized hardware</span
              >
            </a>
          </div>
        </div>

        <div class="affiliate-section">
      <!-- Partners Section (Renamed from Affiliates) -->
      <section class="partners-section" id="partners-section">
        <div class="partners-container">
          <div class="partners-header">
            <h2>Trusted Partners</h2>
            <p>
              Join thousands of developers building the future of local AI with
              our ecosystem partners.
            </p>
          </div>
          <div class="partners-grid">
            <a
              href="https://github.com/mudler/LocalAI"
              target="_blank"
              class="partner-card"
            >
              <div class="partner-icon">🚀</div>
              <div class="partner-name">LocalAI Core</div>
              <div class="partner-desc">
                The engine powering our studio. Drop-in replacement for OpenAI
                API.
              </div>
            </a>
            <a href="https://ollama.com" target="_blank" class="partner-card">
              <div class="partner-icon">🦙</div>
              <div class="partner-name">Ollama</div>
              <div class="partner-desc">
                Get up and running with large language models locally.
              </div>
            </a>
            <a
              href="https://huggingface.co"
              target="_blank"
              class="partner-card"
            >
              <div class="partner-icon">🤗</div>
              <div class="partner-name">Hugging Face</div>
              <div class="partner-desc">
                The AI community building the future. Source of our models.
              </div>
            </a>
          </div>
        </div>
      </section>
    </div>

    <!-- Progress Modal -->
    <div class="progress-modal" id="progressModal">
      <div class="progress-content">
        <div class="progress-header">
          <h3 id="progressTitle">Installing Model</h3>
          <p id="progressModelName">Downloading and setting up...</p>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <div class="progress-percentage" id="progressPercentage">0%</div>
        <div class="progress-status" id="progressStatus">
          Starting download...
        </div>
        <button
          class="progress-close"
          id="progressClose"
          onclick="closeProgressModal()"
        >
          Close
        </button>
      </div>
    </div>

    <!-- License/Upgrade Modal -->
    <div class="modal" id="upgradeModal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeUpgradeModal()">×</button>
        <h2 class="modal-title">Upgrade to Pro</h2>
        <div class="modal-body">
          <!-- Content will be dynamically generated by showUpgradeModal() -->
        </div>
      </div>
    </div>

    <!-- Upgrade Bar (shown for free users) -->
    <div id="upgradeBar">
      <div class="upgrade-bar-content">
        <div class="upgrade-bar-icon">🔒</div>
        <div class="upgrade-bar-text">
          <h4>Unlock 8 More Premium Models</h4>
          <p>
            Get lifetime access to Llama 3.1 8B, CodeLlama, Mistral, and more
            for just $5
          </p>
        </div>
      </div>
      <button class="upgrade-bar-btn" onclick="showUpgradeModal()">
        Upgrade to Pro
      </button>
      <button class="upgrade-bar-close" onclick="closeUpgradeBar()">×</button>
    </div>

    <script>
      const messagesContainer = document.getElementById("messages");
      const messageInput = document.getElementById("messageInput");
      const sendButton = document.getElementById("sendButton");
      const chatForm = document.getElementById("chatForm");
      const statusText = document.getElementById("statusText");
      const modelSelect = document.getElementById("modelSelect");

      let isWelcomeVisible = true;
      let installedModels = ["tinyllama:latest"];
      let currentInstallations = new Map(); // Track ongoing installations

      // License Management
      let currentTier = "free"; // 'free' or 'pro'
      const GUMROAD_PRODUCT_URL = "https://wmeldman.gumroad.com/l/udody"; // Actual Gumroad product page

      // Free tier models (3 models)
      const FREE_MODELS = ["tinyllama:latest", "llama3.2:3b", "gemma2:2b"];

      // Pro tier models (11 models total: 3 free + 8 additional)
      const PRO_MODELS = [
        "tinyllama:latest",
        "llama3.2:3b",
        "gemma2:2b",
        "llama3.1:8b",
        "codellama:7b",
        "mistral:7b-instruct",
        "phi3:medium",
        "gemma2:9b",
        "phi3.5:mini",
        "qwen2.5:7b",
        "deepseek-coder:6.7b",
      ];

      // Check license on page load
      async function checkLicense() {
        const savedKey = localStorage.getItem("licenseKey");
        if (savedKey) {
          console.log("Found saved license key, validating...");
          try {
            // Send license key as query param to validate persistence
            const response = await fetch(
              `/api/license/check?license_key=${encodeURIComponent(savedKey)}`
            );
            if (response.ok) {
              const data = await response.json();
              if (data.tier === "pro") {
                currentTier = "pro";
                setProTier();
                console.log("✅ Pro tier activated");
                return;
              }
            }
          } catch (error) {
            console.log("License check failed, defaulting to free tier");
          }
        }

        // Default to free tier
        currentTier = "free";
        setFreeTier();
        console.log("📦 Free tier active (3 models)");
      }

      // Show upgrade modal
      function showUpgradeModal() {
        const modal = document.getElementById("upgradeModal");
        const modalTitle = modal.querySelector(".modal-title");
        const modalBody = modal.querySelector(".modal-body");
        
        // Reset modal content first
        modal.classList.remove("manage-mode");

        if (currentTier === 'pro') {
            // MANAGE MODE
            modal.classList.add("manage-mode");
            modalTitle.textContent = "Manage License";
            
            // Get saved key safely
            const savedKey = localStorage.getItem('licenseKey') || 'Unknown';
            const maskedKey = savedKey.length > 8 ? savedKey.substring(0, 4) + '...' + savedKey.substring(savedKey.length - 4) : '****';

            modalBody.innerHTML = `
                <div class="license-status-card" style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; padding: 1.5rem; border-radius: 12px; text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">✅</div>
                    <h3 style="color: #10b981; margin-bottom: 0.5rem;">Pro Active</h3>
                    <p style="color: #a1a1aa; margin-bottom: 0;">Your license is valid and active.</p>
                    <div style="margin-top: 1rem; font-family: monospace; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 6px; display: inline-block;">
                        Key: ${maskedKey}
                    </div>
                </div>

                <div class="modal-actions" style="display: flex; flex-direction: column; gap: 1rem;">
                    <button onclick="deactivateLicense()" class="modal-btn secondary" style="width: 100%; background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid #ef4444;">
                        Deactivate / Remove License
                    </button>
                    <button onclick="closeUpgradeModal()" class="modal-btn primary" style="width: 100%;">
                        Close
                    </button>
                </div>
            `;
        } else {
            // UPGRADE MODE (Default)
            modalTitle.textContent = "Upgrade to Pro";
            modalBody.innerHTML = `
                <div class="pricing-header">
                    <div class="price-large">$5 <span class="period">/ lifetime</span></div>
                    <p class="price-subtitle">One-time payment. Own it forever.</p>
                </div>
                
                <div class="features-list">
                    <div class="feature-item">
                        <span class="feature-icon">🚀</span>
                        <span class="feature-text">Unlock <strong>All 11 AI Models</strong></span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">⚡</span>
                        <span class="feature-text"><strong>Uncensored</strong> & Unrestricted Models</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">🔒</span>
                        <span class="feature-text"><strong>100% Private</strong> - Runs Locally</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">💎</span>
                        <span class="feature-text">Support Independent Development</span>
                    </div>
                </div>

                <div class="license-form">
                    <div class="input-group">
                        <label>Already purchased? Enter License Key:</label>
                        <input type="text" id="licenseKeyInput" placeholder="ABCD-1234-EFGH-5678" class="license-input" />
                        <div id="licenseError" class="error-msg"></div>
                        <div id="licenseSuccess" class="success-msg"></div>
                    </div>
                    <div class="modal-actions">
                        <button onclick="openGumroad()" class="modal-btn primary">Get Pro Access ($5)</button>
                        <button onclick="activateLicense()" class="modal-btn secondary">Activate</button>
                    </div>
                </div>
            `;
        }

        modal.classList.add("active");
      }

      // Close upgrade modal
      function closeUpgradeModal() {
        const modal = document.getElementById("upgradeModal");
        modal.classList.remove("active");
      }

      // Open Gumroad purchase page
      function openGumroad() {
        window.open(GUMROAD_PRODUCT_URL, "_blank");
      }

      // Deactivate license (for testing/reset)
      function deactivateLicense() {
        if(confirm('Are you sure you want to deactivate your Pro license?')) {
            localStorage.removeItem('licenseKey');
            window.location.reload();
        }
      }

      // Activate license key
      // Improved License Activation Function with Loading States and Better Error Handling
      async function activateLicense() {
        const licenseKeyInput = document.getElementById("licenseKeyInput");
        const licenseError = document.getElementById("licenseError");
        const licenseSuccess = document.getElementById("licenseSuccess");
        const activateBtn = document.querySelector(
          ".license-form .modal-btn.secondary"
        );
        const licenseKey = licenseKeyInput.value.trim();

        // Hide previous messages
        licenseError.classList.remove("visible");
        licenseSuccess.classList.remove("visible");

        if (!licenseKey) {
          licenseError.textContent = "Please enter a license key.";
          licenseError.classList.add("visible");
          return;
        }

        // Show loading state
        const originalBtnText = activateBtn.textContent;
        activateBtn.textContent = "Validating...";
        activateBtn.disabled = true;
        activateBtn.style.opacity = "0.6";
        activateBtn.style.cursor = "wait";

        try {
          // Use relative path for production compatibility
        const response = await fetch('/api/license/validate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ license_key: licenseKey })
        });

        const data = await response.json();

        if (response.ok && data.valid) {
            // Save license key
            localStorage.setItem('licenseKey', licenseKey);

            // Update tier
            currentTier = 'pro';
            setProTier();

            // Show success message
            licenseSuccess.textContent = '✅ Pro Activated! All 9 models unlocked.';
            licenseSuccess.classList.add('visible');
            licenseKeyInput.value = '';

            // Close modal after 2 seconds
            setTimeout(() => {
                closeUpgradeModal();
                licenseSuccess.classList.remove('visible');
            }, 2000);

            console.log('✅ License activated successfully!');
        } else {
            // Specific error messages based on response
            let errorMsg = 'Invalid license key. Please check and try again.';
            
            if (data.message) {
                errorMsg = data.message;
            } else if (response.status === 429) {
            }
            
            licenseError.textContent = errorMsg;
            licenseError.classList.add('visible');
        }
    } catch (error) {
        console.error('License activation error:', error);
        
        // Specific error messages based on error type
        let errorMsg = 'Connection failed. Please check your internet connection.';

          if (error.name === "TypeError" && error.message.includes("fetch")) {
            errorMsg =
              "❌ Backend not running. Start server with: python app.py";
          } else if (error.name === "SyntaxError") {
            errorMsg =
              "❌ Invalid response from server. Please check backend logs.";
          }

          licenseError.textContent = errorMsg;
          licenseError.classList.add("visible");
        } finally {
          // Reset button state
          activateBtn.textContent = originalBtnText;
          activateBtn.disabled = false;
          activateBtn.style.opacity = "1";
          activateBtn.style.cursor = "pointer";
        }
      }

      // Set free tier restrictions
      function setFreeTier() {
        const upgradeBar = document.getElementById("upgradeBar");
        upgradeBar.classList.add("visible");

        // Lock all models except free ones
        document.querySelectorAll(".model-card").forEach((card) => {
          const modelId = card.dataset.modelId;

          if (!FREE_MODELS.includes(modelId)) {
            // Add pro-locked class
            card.classList.add("pro-locked");

            // Create overlay if it doesn't exist
            if (!card.querySelector(".pro-overlay")) {
              const overlay = document.createElement("div");
              overlay.className = "pro-overlay";
              overlay.innerHTML = `
                            <div class="pro-badge">🔒 PRO</div>
                            <div class="pro-unlock-text">Unlock this model with Pro Access</div>
                            <button class="pro-unlock-btn" onclick="showUpgradeModal()">Unlock for $5</button>
                        `;
              card.appendChild(overlay);
            }
          }
        });

        console.log("🔒 Free tier: 3 models available");
      }

      // Set Pro Tier UI
      function setProTier() {
        // Update header badge
        const badge = document.querySelector(".tier-badge");
        badge.textContent = "PRO";
        badge.classList.add("pro");

        // Update upgrade button to Manage License
        const upgradeBtn = document.querySelector(".upgrade-btn");
        upgradeBtn.textContent = "Manage License";
        upgradeBtn.onclick = showUpgradeModal;
        upgradeBtn.style.background = "rgba(255, 255, 255, 0.1)";
        upgradeBtn.style.border = "1px solid rgba(255, 255, 255, 0.2)";

        // Enable all "Start Chat" buttons
        document.querySelectorAll(".chat-btn").forEach((btn) => {
          btn.disabled = false;
          btn.textContent = "Start Chat";
        });

        // Update model badges
        document.querySelectorAll(".model-badge").forEach((badge) => {
          if (badge.textContent === "Pro Only") {
            badge.style.display = "none";
          }
        });
        console.log("🎉 Pro tier: All 9 models unlocked (3 free + 6 pro)!");
      }

      // Close upgrade bar
      function closeUpgradeBar() {
        const upgradeBar = document.getElementById("upgradeBar");
        upgradeBar.classList.remove("visible");
      }

      // Close modal when clicking outside
      document.addEventListener("click", (e) => {
        const modal = document.getElementById("upgradeModal");
        if (e.target === modal) {
          closeUpgradeModal();
        }
      });

      // Handle Enter key in license input
      document
        .getElementById("licenseKeyInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") {
            activateLicense();
          }
        });

      // Initialize dropdown with models
      function updateDropdown() {
        const selectItems = document.getElementById("selectItems");
        const selectSelected = document.querySelector(".select-selected");

        // Clear existing items
        selectItems.innerHTML = "";

        // Add free/installed models group
        const freeGroup = document.createElement("div");
        freeGroup.className = "select-group-label";
        freeGroup.textContent = "⚡ Installed Models";
        selectItems.appendChild(freeGroup);

        // Add installed models to dropdown
        const modelInfo = {
          "tinyllama:latest": "TinyLlama 1.1B - FREE",
          "llama3.2:3b": "Llama 3.2 3B - FREE",
          "gemma2:2b": "Gemma 2 2B - FREE",
          "phi3.5:mini": "Phi-3.5 Mini - PRO",
          "qwen2.5:7b": "Qwen 2.5 7B - PRO",
          "mistral:7b-instruct-v0.3": "Mistral 7B Instruct v0.3 - PRO",
          "llama3.3:70b": "Llama 3.3 70B - PRO",
          "qwen2.5:72b": "Qwen 2.5 72B - PRO",
          "deepseek:v3": "DeepSeek v3 - PRO",
        };

        installedModels.forEach((modelId) => {
          const option = document.createElement("div");
          option.className = "select-option";
          if (modelId === modelSelect.value) {
            option.classList.add("selected");
          }
          option.classList.add("installed");
          option.setAttribute("data-value", modelId);
          option.textContent = modelInfo[modelId] || modelId;

          option.addEventListener("click", function (e) {
            e.stopPropagation();
            selectModel(modelId, modelInfo[modelId] || modelId);
          });

          selectItems.appendChild(option);
        });

        // Add not installed models group if there are any
        const notInstalled = Object.keys(modelInfo).filter(
          (m) => !installedModels.includes(m)
        );
        if (notInstalled.length > 0) {
          const otherGroup = document.createElement("div");
          otherGroup.className = "select-group-label";
          otherGroup.textContent = "💎 Available Models";
          selectItems.appendChild(otherGroup);

          notInstalled.forEach((modelId) => {
            const option = document.createElement("div");
            option.className = "select-option";
            option.setAttribute("data-value", modelId);
            option.textContent = modelInfo[modelId] + " (Not Installed)";
            option.style.opacity = "0.6";
            option.style.cursor = "not-allowed";

            option.addEventListener("click", function (e) {
              e.stopPropagation();
              alert("Please install this model from the marketplace first.");
            });

            selectItems.appendChild(option);
          });
        }
      }

      function selectModel(value, text) {
        const selectSelected = document.querySelector(".select-selected");
        const customSelect = document.getElementById("customSelect");

        modelSelect.value = value;
        selectSelected.textContent = text;
        customSelect.classList.remove("open");

        // Update selected state
        document.querySelectorAll(".select-option").forEach((opt) => {
          opt.classList.remove("selected");
          if (opt.getAttribute("data-value") === value) {
            opt.classList.add("selected");
          }
        });
      }

      // Custom Dropdown Functionality
      const customSelect = document.getElementById("customSelect");
      const selectSelected = customSelect.querySelector(".select-selected");

      // Toggle dropdown
      selectSelected.addEventListener("click", function (e) {
        e.stopPropagation();
        customSelect.classList.toggle("open");
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", function () {
        customSelect.classList.remove("open");
      });

      // Progress Modal Functions
      function showProgressModal(modelName) {
        const modal = document.getElementById("progressModal");
        const title = document.getElementById("progressTitle");
        const modelNameEl = document.getElementById("progressModelName");
        const progressBar = document.getElementById("progressBar");
        const progressPercentage =
          document.getElementById("progressPercentage");
        const progressStatus = document.getElementById("progressStatus");
        const progressClose = document.getElementById("progressClose");

        title.textContent = "Installing Model";
        modelNameEl.textContent = modelName;
        progressBar.style.width = "0%";
        progressPercentage.textContent = "0%";
        progressStatus.textContent = "Connecting to Ollama...";
        progressClose.classList.remove("visible");

        modal.classList.add("active");
      }

      function updateProgress(percentage, status) {
        const progressBar = document.getElementById("progressBar");
        const progressPercentage =
          document.getElementById("progressPercentage");
        const progressStatus = document.getElementById("progressStatus");

        progressBar.style.width = percentage + "%";
        progressPercentage.textContent = percentage + "%";
        if (status) {
          progressStatus.textContent = status;
        }
      }

      function closeProgressModal() {
        const modal = document.getElementById("progressModal");
        modal.classList.remove("active");
      }

      function completeProgress(success = true) {
        const progressStatus = document.getElementById("progressStatus");
        const progressClose = document.getElementById("progressClose");
        const progressTitle = document.getElementById("progressTitle");

        if (success) {
          updateProgress(100, "Installation complete!");
          progressTitle.textContent = "✅ Success!";
        } else {
          progressTitle.textContent = "❌ Installation Failed";
          progressStatus.textContent =
            "Please check Ollama is running and try again.";
        }

        progressClose.classList.add("visible");
      }

      // Install Model Function with Real SSE Streaming
      async function installModel(modelName) {
        const card = document.querySelector(`[data-model-id="${modelName}"]`);
        if (!card) return;

        const badge = card.querySelector(".model-badge");
        const installBtn = card.querySelector(".install-btn");
        const chatBtn = card.querySelector(".chat-btn");
        const modelDisplayName = card.querySelector(".model-name").textContent;

        // Check if already installing
        if (currentInstallations.has(modelName)) {
          console.log(`Model ${modelName} is already being installed`);
          return;
        }

        // Mark as installing
        currentInstallations.set(modelName, true);

        // Update UI
        badge.textContent = "Installing...";
        badge.classList.remove("not-installed", "installed");
        badge.classList.add("installing");
        installBtn.disabled = true;
        installBtn.textContent = "Installing...";

        // Show progress modal
        showProgressModal(modelDisplayName);

        try {
          // Use EventSource for Server-Sent Events (SSE) streaming
          const eventSource = new EventSource(
            `/api/models/install?model=${encodeURIComponent(modelName)}`
          );

          console.log(`[INSTALL] Started EventSource for ${modelName}`);

          eventSource.onmessage = function (event) {
            try {
              const data = JSON.parse(event.data);
              console.log("[INSTALL] Progress:", data);

              // Handle different status types from Ollama
              if (data.status === "error") {
                console.error("[INSTALL] Error:", data.error);
                eventSource.close();
                throw new Error(data.error || "Installation failed");
              } else if (data.status === "success") {
                // Installation complete
                console.log("[INSTALL] Success!");
                eventSource.close();

                updateProgress(100, "Installation complete!");
                completeProgress(true);

                // Update UI
                badge.textContent = "✓ INSTALLED";
                badge.classList.remove("installing", "not-installed");
                badge.classList.add("installed");
                installBtn.textContent = "Installed";
                installBtn.style.opacity = "0.5";
                chatBtn.disabled = false;

                // Add to installed models list
                if (!installedModels.includes(modelName)) {
                  installedModels.push(modelName);
                  updateDropdown();
                }

                // Remove from current installations
                currentInstallations.delete(modelName);
              } else {
                // Progress update from Ollama
                let percentage = 0;
                let statusText = data.status || "Downloading...";

                // Calculate progress percentage
                if (data.total && data.completed) {
                  percentage = Math.round((data.completed / data.total) * 100);
                } else if (data.status === "pulling manifest") {
                  percentage = 5;
                  statusText = "Pulling manifest...";
                } else if (data.status === "downloading digestname") {
                  percentage = 10;
                  statusText = "Starting download...";
                } else if (data.status === "verifying sha256 digest") {
                  percentage = 95;
                  statusText = "Verifying download...";
                } else if (data.status === "writing manifest") {
                  percentage = 98;
                  statusText = "Writing manifest...";
                }

                updateProgress(percentage, statusText);
              }
            } catch (err) {
              console.error("[INSTALL] Parse error:", err);
            }
          };

          eventSource.onerror = function (err) {
            console.error("[INSTALL] EventSource error:", err);
            eventSource.close();

            completeProgress(false);

            // Reset UI
            badge.textContent = "Not Installed";
            badge.classList.remove("installing", "installed");
            badge.classList.add("not-installed");
            installBtn.disabled = false;
            installBtn.textContent = "Install Now";

            // Remove from current installations
            currentInstallations.delete(modelName);
          };
        } catch (error) {
          console.error("Installation error:", error);
          completeProgress(false);

          // Reset UI
          badge.textContent = "Not Installed";
          badge.classList.remove("installing", "installed");
          badge.classList.add("not-installed");
          installBtn.disabled = false;
          installBtn.textContent = "Install Now";

          // Remove from current installations
          currentInstallations.delete(modelName);
        }
      }

      // Scroll to marketplace section
      function scrollToMarketplace() {
        const modelsSection = document.querySelector(".models-section");
        if (messagesContainer && modelsSection) {
          modelsSection.style.display = "block";
          isWelcomeVisible = true;
          messagesContainer.innerHTML = "";
          messagesContainer.appendChild(modelsSection);
          messagesContainer.scrollTo({
            top: 0,
            behavior: "smooth",
          });
        }
      }

      // Auto-resize textarea
      messageInput.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = Math.min(this.scrollHeight, 200) + "px";
      });

      // Handle form submission
      chatForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const message = messageInput.value.trim();
        if (!message) return;

        // Remove welcome screen on first message
        if (isWelcomeVisible) {
          messagesContainer.innerHTML = "";
          isWelcomeVisible = false;
        }

        // Get selected model text from custom dropdown
        const currentModel = selectSelected.textContent;

        // Add user message
        addMessage("user", message, currentModel);
        messageInput.value = "";
        messageInput.style.height = "auto";

        // Disable input while processing
        sendButton.disabled = true;
        messageInput.disabled = true;

        // Add loading message
        const loadingId = addMessage(
          "assistant",
          '<div class="loading"><span></span><span></span><span></span></div>',
          currentModel,
          true
        );

        // Send to backend
        try {
          const response = await fetch("/api/chat", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: message,
              model: modelSelect.value,
            }),
          });

          if (response.ok) {
            const data = await response.json();
            removeMessage(loadingId);
            addMessage(
              "assistant",
              data.response || "Backend connected! Chat endpoint working.",
              currentModel
            );
          } else {
            removeMessage(loadingId);
            addMessage(
              "assistant",
              `⚠️ Backend API needs /api/chat endpoint implementation.\n\nYour message: "${message}"\nModel: ${currentModel}\n\nBackend is running but needs the chat logic added.`,
              currentModel
            );
          }
        } catch (error) {
          removeMessage(loadingId);
          addMessage(
            "assistant",
            `⚠️ Connection error. Backend running but /api/chat not implemented.\n\nNext step: Add chat endpoint to backend/main.py`,
            currentModel
          );
        }

        // Re-enable input
        sendButton.disabled = false;
        messageInput.disabled = false;
        messageInput.focus();
      });

      // Handle Shift+Enter for new line, Enter to send
      messageInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          chatForm.dispatchEvent(new Event("submit"));
        }
      });

      // Add message to chat
      function addMessage(role, text, model, isLoading = false) {
        const messageId = "msg-" + Date.now();
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${role}`;
        messageDiv.id = messageId;

        const avatar = role === "user" ? "You" : "AI";
        const time = new Date().toLocaleTimeString();

        messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="message-text">${text}</div>
                        ${
                          !isLoading
                            ? `
                            <div class="message-meta">
                                <span class="message-time">${time}</span>
                                <span class="message-model">${model}</span>
                            </div>
                        `
                            : ""
                        }
                    </div>
                </div>
            `;

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;

        return messageId;
      }

      // Remove message
      function removeMessage(messageId) {
        const message = document.getElementById(messageId);
        if (message) message.remove();
      }

      // Check backend health and update connection status
      async function checkBackend() {
        const statusDot = document.querySelector(".status-dot");
        const statusText = document.getElementById("statusText");

        // Set connecting state
        statusDot.className = "status-dot connecting";

        try {
          const response = await fetch("/api/health", { timeout: 3000 });
          if (response.ok) {
            console.log("✅ Backend connected and healthy");
            statusDot.className = "status-dot";
            statusText.textContent = "100% Local";
            return true;
          }
        } catch (error) {
          console.log("⚠️ Backend check failed:", error.message);
        }

        // Failed to connect
        statusDot.className = "status-dot disconnected";
        statusText.textContent = "Disconnected";
        return false;
      }

      // Periodically check connection status
      setInterval(checkBackend, 10000); // Check every 10 seconds

      // Load installed models dynamically
      async function loadInstalledModels() {
        try {
          const response = await fetch("/api/models");
          const data = await response.json();
          const installed = data.installed || [];

          console.log(`Found ${installed.length} installed models:`, installed);

          // Update our local list
          installedModels = [
            "tinyllama:latest",
            ...installed.filter((m) => m !== "tinyllama:latest"),
          ];

          // Update model cards
          document.querySelectorAll(".model-card").forEach((card) => {
            const modelId = card.dataset.modelId;
            const badge = card.querySelector(".model-badge");
            const installBtn = card.querySelector(".install-btn");
            const chatBtn = card.querySelector(".chat-btn");

            if (modelId === "tinyllama:latest") return; // Skip pre-installed

            const isInstalled = installedModels.some(
              (m) => m === modelId || m.startsWith(modelId.split(":")[0])
            );

            if (isInstalled) {
              badge.textContent = "✓ INSTALLED";
              badge.classList.remove("not-installed");
              badge.classList.add("installed");
              if (installBtn) {
                installBtn.disabled = true;
                installBtn.textContent = "Installed";
                installBtn.style.opacity = "0.5";
              }
              chatBtn.disabled = false;
            }
          });

          // Update dropdown
          updateDropdown();
        } catch (error) {
          console.log("Failed to load models:", error);
        }
      }

      // Handle button clicks
      document.addEventListener("click", async (e) => {
        // Handle Install button clicks
        if (e.target.classList.contains("install-btn")) {
          const modelId = e.target.dataset.model;
          if (!e.target.disabled) {
            await installModel(modelId);
          }
        }

        // Handle Start Chat button clicks
        if (e.target.classList.contains("chat-btn")) {
          const modelId = e.target.dataset.model;

          // Hide models section and show chat
          const modelsSection = document.querySelector(".models-section");
          if (modelsSection) {
            modelsSection.style.display = "none";
            isWelcomeVisible = false;
          }

          // Select the model in dropdown
          const modelName = e.target
            .closest(".model-card")
            .querySelector(".model-name").textContent;
          selectModel(modelId, modelName);

          // Add a welcome message
          addMessage(
            "assistant",
            `Hello! I'm ${modelName}. How can I help you today?`,
            modelName
          );

          // Focus on input
          messageInput.focus();
        }
      });

      // Initialize on page load
      updateDropdown();
      checkBackend();
      loadInstalledModels();
      checkLicense(); // Check license and apply tier restrictions
      messageInput.focus();
    </script>
  </body>
</html>
